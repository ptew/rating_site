
{% extends "base.html" %}
{% load dajaxice_templatetags %}
{% load ratings_filters %}

{% block title %}
Invest Competition
{% endblock %}

{% block head %}
  {% dajaxice_js_import %}

  <script type="text/javascript">
      $(document).ready(function(){
        $('.carousel').carousel('pause');
      });

      function next_carousel() {
        $('#carousel-id').carousel('next');
          console.log('mother');
        }

      function my_callback(data){
        console.log("Vote Registered! with " + data.message);
      };

      $(window).load(function(){
        var world = $($("#world")[0]).data('world');
        console.log("World: " + world);
        $('#loadModal').modal('show');
    });

    function submit() {
      $(".rateit.vote").each( function() {
          var rater = $(this);
          var value = rater.rateit('value');

          var advice_id = $(rater).data('advice-id');
          var profile_id = $(rater).data('profile-id');
          var user_id = $($("#uid")[0]).data('uid');
          var isPerformance = rater.hasClass("performance");
          Dajaxice.ratings.click_vote(my_callback, {'value':value, 'advice_id': advice_id, 'profile_id': profile_id, 'isPerformance': isPerformance, 'is_submission': true, 'id_number': user_id});
          console.log("Voting for submission vote");
      });
    }

    $(function ()  
      { $("[rel=status]").popover({title: 'Status', content: "Status tells us how well the person is respected."});  
    });
    $(function ()  
      { $("[rel=reputation]").popover({title: 'Reputation', content: "Reputation tells us how well the person is respected."});  
    });  
  </script>
{% endblock %}

{% block body %}
<div class="wide container">

  <div class="advice_list large-12">
    <div id="carousel-id" class="carousel slide"><!-- class of slide for animation -->
      <div class="carousel-inner">
        {% block content %}
          {% if advice_list %}
              {% for advice in advice_list %}
                {% if forloop.counter == 1 %}
                  <div class="item active large-12 columns">
                {% else %}
                  <div class="item large-12 columns">
                {% endif %}
                  <h2>{{ advice.company }} (US: {{advice.ticker}})</h2>
                  <div class="medium-7 columns left">
                    <div class="rating_left">
                      <h5 class="left"> Price Target: ${{advice.price_target}}</h5>
                    </div>
                    <div class="rating_right">
                      <h5 class="left">Time Frame: {{advice.time_scale}}</h5>
                    </div>
                  </div>
                  {% if world_number > 1 %}
                    <div class="left medium-7 columns">
                        <h6 class="left" rel="status" data-trigger="hover" data-placement="bottom"><b>This individual's last ideas have {{advice_status|get_status:advice}} the market.</b></h6>

                        <h6 class="left " rel="reputation" data-trigger="hover" data-placement="bottom"><b>This individual's firm was recently ranked {{advice_rep|get_rep:advice}} in a survey by its peers.</b></h6>
                    </div>
                  {% endif %}
                  <div class="medium-7 columns">
                    <p class="advice_content">{{advice.content}}</p>
                  </div>
                  <div class="company_stats medium-3 columns">
                    <h5>Statistics: </h5>
                    <ul class="statistics">
                      <li>Asset Class: Common Equity</li>
                      <li>Price at Recommendation: $XX.YY</li>
                      <li>Recommendation: Long</li>
                      <li>Market Cap.: Small Cap</li>
                      <li>Country: United States</li>
                      <li>Situation: Value</li>
                    </ul>
                  </div>
                  
                  <div class="medium-7 columns">
                    <div class="rating_left">
                      <h4 class="left"><small>Rate Quality: </small></h4>
                      {% if advice.company in quality_votes %}
                      <input type="range" value={{quality_votes|get_item:advice.company}} max="5" step="1" id="quality-backing{{forloop.counter}}">
                      <div class="rateit left custom_rating quality vote" data-rateit-backingfld="#quality-backing{{forloop.counter}}" 
                      data-rateit-value={{quality_votes|get_item:advice.company}}
                      data-advice-id={{advice.id}} data-profile-id={{profile_dict|get_item:advice}} data-rateit-resetable="false"></div>
                      {% else %}
                      <input type="range" max="5" value="0" step="1" id="quality-backing{{forloop.counter}}">
                      <div class="rateit left custom_rating quality vote" data-rateit-backingfld="#quality-backing{{forloop.counter}}" 
                      data-rateit-resetable="false" data-rateit-ispreset="true"  data-rateit-min="0" data-rateit-max="5" data-advice-id={{advice.id}} data-profile-id={{profile_dict|get_item:advice}}></div>
                      {% endif %}
                    </div>

                    <div class="rating_right">
                      <h4 class="left"><small>Rate Performance: </small></h4>
                      {% if advice.company in performance_votes %}
                      <input type="range" value={{performance_votes|get_item:advice.company}} max="5" step="1" id="performance-backing{{forloop.counter}}">
                      <div class="rateit left custom_rating performance vote" data-rateit-backingfld="#performance-backing{{forloop.counter}}" 
                       data-rateit-value={{performance_votes|get_item:advice.company}} data-advice-id={{advice.id}} data-profile-id={{profile_dict|get_item:advice}} data-rateit-resetable="false"></div>
                      {% else %}
                      <input type="range" max="5" value="0" step="1" id="performance-backing{{forloop.counter}}">
                      <div class="rateit left custom_rating performance vote" data-rateit-backingfld="#performance-backing{{forloop.counter}}" 
                      data-rateit-resetable="false"  data-rateit-min="0" data-rateit-max="10" data-advice-id={{advice.id}} data-profile-id={{profile_dict|get_item:advice}}></div>
                      {% endif %}
                    </div>
                  </div>
                  <div class="medium-7 columns left">
                    <hr>
                  </div>
                  <div class="medium-7 columns left">
                    {% if forloop.last %}
                      <center><button id="submit" class="submit_button btn btn-default" data-toggle="modal" data-target="#submitModal" onclick="submit();">Submit</button></center>
                    {% else %}
                      <center><button id="next_button" class="submit_button btn btn-default" onclick="next_carousel();">Next</button></center>
                    {% endif %}
                  </div>
                </div>

              {% endfor %}
          {% else %}
            <p>No advice is available.</p>
          {% endif %}
        </div><!-- /.carousel-inner -->
      </div><!-- /.carousel --> 
      
      <script type="text/javascript">
                $(".rateit").bind('rated reset', function (event) {
                  var rater = $(this);
                  var value = rater.rateit('value');
                  // $(this).attr('class', 'clicked');

                  //Disable Voting
                  // rater.rateit('readonly', true);

                  var advice_id = $(rater).data('advice-id');
                  var profile_id = $(rater).data('profile-id');
                  var user_id = $($("#uid")[0]).data('uid');
                  console.log(user_id)
                  var isPerformance = rater.hasClass("performance");
                  Dajaxice.ratings.click_vote(my_callback, {'value':value, 'advice_id': advice_id, 'profile_id': profile_id, 'isPerformance': isPerformance, 'is_submission': false, 'id_number': user_id});
                });
        </script>   
  </div>
    {% endblock %}
</div><!-- /.container -->


<!-- Modal -->
<div class="modal fade" id="submitModal" tabindex="-1" role="dialog" aria-labelledby="submitModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Survey</h4>
      </div>
        <div class="modal-body">

            <!-- Multiple Radios -->
            <div class="control-group">
              <label class="control-label" for="radios"><h4>Question 1</h4></label>
              <div class="controls">
                <label class="radio" for="radios-0">
                  <input type="radio" name="radios" id="radios-0" value="Option one" checked="checked">
                  Option one
                </label>
                <label class="radio" for="radios-1">
                  <input type="radio" name="radios" id="radios-1" value="Option two">
                  Option two
                </label>
                <label class="radio" for="radios-2">
                  <input type="radio" name="radios" id="radios-2" value="Option three">
                  Option three
                </label>
                <label class="radio" for="radios-3">
                  <input type="radio" name="radios" id="radios-3" value="Option four">
                  Option four
                </label>
              </div>
            </div>

            <!-- Textarea -->
            <div class="control-group">
              <label class="control-label" for="textarea"><h4>Question 2</h4></label>
              <div class="controls">                     
                <textarea id="textarea" name="textarea">default text</textarea>
              </div>
            </div>

            <!-- Multiple Checkboxes (inline) -->
            <div class="control-group">
              <label class="control-label" for="checkboxes"><h4>Question 3</h4></label>
              <div class="controls">
                <label class="checkbox inline" for="checkboxes-0">
                  <input type="checkbox" name="checkboxes" id="checkboxes-0" value="1">
                  1
                </label>
                <label class="checkbox inline" for="checkboxes-1">
                  <input type="checkbox" name="checkboxes" id="checkboxes-1" value="2">
                  2
                </label>
                <label class="checkbox inline" for="checkboxes-2">
                  <input type="checkbox" name="checkboxes" id="checkboxes-2" value="3">
                  3
                </label>
                <label class="checkbox inline" for="checkboxes-3">
                  <input type="checkbox" name="checkboxes" id="checkboxes-3" value="4">
                  4
                </label>
                <label class="checkbox inline" for="checkboxes-4">
                  <input type="checkbox" name="checkboxes" id="checkboxes-4" value="5">
                  5
                </label>
              </div>
            </div>

            <!-- Textarea -->
            <div class="control-group">
              <label class="control-label" for="textarea"><h4>Question 4</h4></label>
              <div class="controls">                     
                <textarea id="textarea" name="textarea">default text</textarea>
              </div>
            </div>
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">Save changes</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="loadModal" tabindex="-1" role="dialog" aria-labelledby="loadModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Investment Idea Competition</h4>
      </div>
        <div class="modal-body">
          You will be presented with four diverse investment ideas to rate on quality and expected performance. Since this is got a competition, all information that can identify the user has been removed. Instead, we will give you some information about the user.
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
      </div>
    </div>
  </div>
</div>
<div id="uid" data-uid={{user.user_id}}></div>
<div id="world" data-world={{world_number}}></div>
{% endblock %}
